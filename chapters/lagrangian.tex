\chapter{Lagrangian Domain: Vortex Particle Method}
\label{ch:theory}

	
	\lsymb[f]{$\mathbf{x}$}{Position vector}{\si{\m}}{x}
	\lsymb[f]{$\mathbf{x}_p$}{Position vector of the particle}{\si{\m}}{xp}
	\lsymb[f]{$\mathbf{x}_{\nu}$}{Position vector of particle to be diffused}{\si{\m}}{xmm}
	\lsymb[f]{$t$}{Time}{\si{\s}}{t}
	\lsymb[f]{$\mathbf{u}$}{Velocity}{\si{\m\per\s}}{u}
	%\lsymb[f]{$\mathbf{u}\left(\mathbf{x},t\right)$}{Velocity field}{$[m\cdot s^{-1}]$}{ua}
	\lsymb[f]{$p$}{Pressure}{\si{\pascal}}{p}
	\lsymb[f]{$\mathbf{u}^h$}{Discrete velocity}{\si{\m\per\s}}{uh}	
	\lsymb[f]{$\mathbf{u}_{\infty}$}{Free-stream velocity}{\si{\m\per\s}}{ul}
	\lsymb[f]{$\mathbf{u}_{\omega}$}{Vortical velocity}{\si{\m\per\s}}{uz}
	\lsymb[f]{$\mathbf{u}_{\phi}$}{Potential velocity}{\si{\m\per\s}}{up}
	\lsymb[f]{$\mathbf{u}_{\gamma}$}{Vortex sheet induced velocity}{\si{\m\per\s}}{uc}
	\lsymb[f]{$\mathbf{u}_{\mathrm{ext}}$}{External induced velocity}{\si{\m\per\s}}{ue}
	\lsymb[f]{$\mathbf{u}_{b}$}{Velocity of the body}{\si{\m\per\s}}{ub}	
	\lsymb[f]{$\mathbf{u}_{\mathrm{slip}}$}{Boundary slip velocity}{\si{\m\per\s}}{us}	
	\lsymb[f]{$u_{r}$}{Radial velocity}{\si{\m\per\s}}{ur}	
	\lsymb[f]{$u_{\theta}$}{Angular velocity}{\si{\m\per\s}}{uhh}	

		
	\lsymb[f]{$N_p$}{Number of particles}{-}{np}	
	\lsymb[f]{$\mathbf{K}$}{Biot-Savart kernel}{-}{k}
	\lsymb[f]{$\mathbf{K_{\sigma}}$}{Vortex blob kernel}{-}{kb}	
	\lsymb[f]{$h$}{Nominal particle spacing}{\si{m}}{h}	
	\lsymb[f]{$\mathrm{overlap}$}{Overlap ratio of the blobs}{-}{o}	
	\lsymb[f]{$W$}{Interpolation kernel weight}{-}{w}
	\lsymb[f]{$\mathcal{E}$}{Enstrophy}{\si{m^2.s^{-2}}}{en}
	\lsymb[f]{$c^2$}{Diffusion parameter}{-}{c}
	\lsymb[f]{$\mathbf{\hat{n}}$}{Normal vector}{-}{n}
	\lsymb[f]{$\mathbf{\hat{s}}$}{Tangent vector}{-}{s}	
	\lsymb[f]{$h_{\nu}$}{Characteristic diffusion distance}{\si{m}}{hm}		
	\lsymb[f]{$k_{d}$}{Diffusion frequency multiple}{-}{kd}			
	
	\lsymb[f]{$\mathbf{A}$}{Vortex panel influence matrix}{-}{kd}				

	\lsymb[f]{$r$}{Radial position}{\si{m}}{r}

	\gsymb[f]{$\zeta_{\sigma}$}{Smooth cut-off function of the blob}{-}{ff}	
	\gsymb[f]{$\rho$}{Density}{\si{kg.m^{-3}}}{qq}
	\gsymb[f]{$\nu$}{Kinematic viscosity}{\si{m^2.s^{-1}}}{mm}
	\gsymb[f]{$\Gamma$}{Circulation}{\si{m^2.s^{-1}}}{c}
	\gsymb[f]{$\Gamma_{\omega}$}{Circulation of the fluid}{\si{m^2.s^{-1}}}{cxx}	
	\gsymb[f]{$\Gamma_{\gamma}$}{Circulation of vortex sheet}{\si{m^2.s^{-1}}}{ccc}		
	\gsymb[f]{$\Gamma_{b}$}{Circulation of moving body}{\si{m^2.s^{-1}}}{cb}			
	\gsymb[f]{$\omega$}{Vorticity}{\si{s^{-1}}}{xx}
	\gsymb[f]{$\omega^h$}{Discrete vorticity field}{\si{s^{-1}}}{xxh}
	\gsymb[f]{$\alpha_p$}{Circulation of the particle}{\si{m^2.s^{-1}}}{aap}
	\gsymb[f]{$\beta_p$}{Corrected circulation of the particle}{\si{m^2.s^{-1}}}{bbp}
	%\gsymb[f]{$\epsilon$}{Distance between the particles}{$[m]$}{eep}
	\gsymb[f]{$\sigma$}{Core size}{\si{m}}{rr}
	\gsymb[f]{$\Delta t_d$}{Diffusion time-step size}{\si{s}}{dtd}	
	\gsymb[f]{$\Delta t_c$}{Convection time-step size}{\si{s}}{dtc}		
	\gsymb[f]{$\gamma$}{Vortex sheet strengths}{\si{s}}{cc}		
	\gsymb[f]{$\xi$}{Scale relative position of particle to stencil node}{-}{nn}
	\gsymb[f]{$\epsilon$}{Relative error}{-}{ee}
	\gsymb[f]{$\tau$}{Scaled viscous time}{\si{m^2}}{ss}
	\gsymb[f]{$\Gamma_c$}{Circulation of the vortex core}{\si{m^2.s^{-1}}}{cc}

%To model the flow around a VAWT, several approaches can be taken, Vermeer at al. (2003) \cite{Vermeer2003} have also summarized in their paper. The two main approaches of investigating the flow is either employing a numerical method to simulate the flow or through experimental simulations.

%Leishman (2006) \cite{leishman2006principles} has shown that there are several simplified, efficient numerical tools that can be used to model the performance of a VAWT. Methods such as actuator disk theory and blade element momentum theory and deals with simplified Navier-Stokes equations and is very useful to evaluate the trend of certain design parameter. However, as they are highly simplified, complex flow phenomenons that has severe impact of the performance characteristics of the VAWT such as flow separation during dynamic stall, vortex shedding during the rotation and blade-wake interaction cannot be simulated. In order to understand them, either experimental investigation such as in wind tunnel or full Navier-Stokes simulations have to undertaken. So to understand the flow behaviour of a VAWT, several numerical research have been performed \cite{Almohammadi2013} \cite{Ferreira2007} \cite{Islam2008} \cite{Merz2012} and experimental researches by Ferreira \cite{SimaoFerreira2008} \cite{Ferreira} and others \cite{Howell2010} \cite{Mertens2003}.
%\index{Actuator disk}

%All the numerical method that was grid-based struggled with dealing with large number of mesh cells for high Reynolds numbers and the numerical method that employed simplified Navier-Stokes methods had to sacrifices some accuracies.The experimental investigation also come with drawbacks as they are require more financial resources and usually only feasible to model the scaled VAWTs.

%This is the main relevance of the hybrid vortex particle method for the VAWT investigations. By utilizing the two methods together, the vortex particle method away from body, and Navier-Stokes solver with turbulence model in the near-body region, one will be able to tackle the challenges in an efficient manner.

%Therefore, this chapter is dedicated to given an overview on the theory of the Vortex Particle Method which we will employ with coupled Navier-Stokes solver. 

%------------------------------------------------------------------------------------------------------
%------------------------------------------------------------------------------------------------------
%------------------------------------------------------------------------------------------------------
\section{Introduction to Vortex Particle Method}
\indexAcron{Vortex Particle Method}{VPM} is a branch of computational fluid dynamics that deals with the evolution of the vorticity of the fluid in a Lagrangian description. Typically, the fluid is viewed at a fixed window where the change in the fluid properties are evaluated. However, the Lagrangian formulation, regard the fluid as a collection of the particles carrying the property of the fluid. 

%\todo{Lagrangian vs. Eulerian fluid diagram}

Unlike the typical Eulerian method that require the discretization of all the fluid domain, VPM only needs fluid elements where there is vorticity. This means that the VPM are inherently auto-adaptive method that only simulated the flow of interest. Furthermore, with the computational acceleration methods such as \printAcron{Fast-Multipole Method}{FMM} and parallel computation in \printAcron{Graphics Processing Unit}{GPU}, VPM are must more efficient at evolving the vorticity field that the typical Eulerian methods.

\subsection{Vorticity}
Vorticity $\omega$, the governing element of vortex particle method, is defined as

	\begin{equation}
	\mathbf{\omega} = \Delta \times \mathbf{u},
	\end{equation}

where $\mathbf{u}$ is the velocity. The circulation $\Gamma$ is defined by the stokes theorem,

	\begin{equation}
	\Gamma = \int_L\mathbf{u}\cdot d \mathbf{s}=\int_A\omega\cdot\mathbf{n}\ dA,
	\label{eq:definitionOfCirculation}
	\end{equation}

and represents the integral vorticity of the domain, figure \ref{fig:vorticityCirculation}

	\begin{figure}[t]
	\centering
	\includegraphics[width=0.3\linewidth]{./figures/lagrangian/vorticityCirculation.pdf}
	\caption{Definition of circulation of the fluid}
	\label{fig:vorticityCirculation}
	\end{figure}

 
\subsection{Velocity-Vorticity formulation of the Navier-Stokes equations}
The governing equation of the vortex particle method is the velocity-vorticity $\mathbf{u}-\omega$ formulation of the Navier-Stokes equations \cite{Cottet2000a}. The 2-D incompressible Navier-Stokes momentum equation is given as,

	\begin{equation}
	\frac{\partial \mathbf{u}}{\partial t} + \mathbf{u}\cdot\nabla\mathbf{u} = - \frac{1}{\rho} \nabla p + \nu \nabla^2\mathbf{u},
	\label{eq:mom}
	\end{equation}

relating the velocity field $\mathbf{u}\left(\mathbf{x},t\right)$ to the pressure field $p\left(\mathbf{x},t\right)$, the kinematic viscosity $\nu$ and density $\rho$. Furthermore, we also have to satisfy the incompressibility constraint given as, 

	\begin{equation}
	\nabla\cdot\mathbf{u} = 0.
	\end{equation}

To attain the velocity-vorticity formulation, we should take the curl of the velocity-pressure formulation $\mathbf{u}-p$ of the Navier-Stokes equation. Taking the curl of the 2-D momentum equation \ref{eq:mom}, we derive the vorticity transport equation

	\begin{equation}
	\frac{\partial \omega}{\partial t} + \mathbf{u}\cdot\nabla\omega = \nu \nabla^2 \omega,
	\end{equation}

which only relates the vorticity to the velocity enabling us to neglect the pressure field. Note that as we are dealing with the two dimensional flow, we can neglected the 3-D stretching term. 


\subsection{Viscous splitting algorithm}
Vortex particle method was initially used to model the evolution of incompressible, inviscid flows. However, in order to simulate a real flow, we must also deal with the viscous behavior of the fluid. Chorin in 1973 \cite{Chorin1973}, showed that using the viscous splitting algorithm, it is possible to take in account of the viscous effects of the flow. 

The viscous splitting algorithm is basically a fractional step method, where the viscous and the inviscid part of the transport equation are dealt with in two subsequent steps, 

	\begin{itemize}
	\item Sub-step 1: \textbf{Convection}
		\begin{equation}
		\frac{\partial\omega}{\partial t} + \mathbf{u}\cdot\nabla\omega=0;
		\label{eq:convectionEulerian}
		\end{equation}
		
	\item Sub-step 2: \textbf{Diffusion}
		\begin{equation}
		\frac{\partial\omega}{\partial t} = \nu\nabla^2\omega.
		\label{eq:vsa2}
		\end{equation}
	
	\end{itemize}

The first sub-step of the evolution deals with the convection of the vorticity. Note that, by convection we imply the advection of the vorticity field where the diffusion process is neglected. The second sub-step is where we deals with the diffusion of the vorticity field. 

There are several advantage to this type of evolution. As the convection and diffusion are handled separately, there is minimum dispersion during the convection step and furthermore, the is no restriction of the advection CFL number, as shown by Wee (2006) \cite{Wee2006}.

There are many ways of dealing with the diffusion of the vorticity field. During this project, we initially used a modified interpolation kernel by Wee (2006) \cite{Wee2006} that can simultaneously treat diffusion and remesh the vortex particles. Later, we used a simple redistribution scheme by Tutty (2010) \cite{2010arXiv1009.0166T}, that was less constrained on time-step size for the diffusion, see section \ref{sec:diffusionVM}.

%------------------------------------------------------------------------------------------------------
%------------------------------------------------------------------------------------------------------
%------------------------------------------------------------------------------------------------------
\section{Spatial Discretization: Generation of Vortex Blobs}
\label{sec:spatialDiscretization}

Before we can convect and diffuse the vorticity field, we must first discretize the vorticity field into Lagrangian fluid elements. For this project we used vortex blobs, that was introduced by Chorin. Vortex blobs are mollified vortex particle carrying the local circulation of the fluid. They describes a smooth vorticity field, and this is important because non-modified vortex particles have asymptotic vorticity distribution and causes issues when particles approach each other.

\subsection{Biot-Savart law}

The velocity field can be decomposed using the Helmholtz decomposition given as,

	\begin{equation}
	\mathbf{u} = \mathbf{u}_{\omega} + \mathbf{u}_{\phi},
	\label{eq:helmholtz}
	\end{equation}

where $\mathbf{u}_{\omega}$ is the rotational component of the velocity and $\mathbf{u}_{\phi}$ is the irrotational component, the solenoidal and the potential velocity respectively. In an unbounded flow we have $\mathbf{u}_{\phi}$ equal to the free-stream velocity $\mathbf{u}_{\infty}$, whereas for bounded flow, we must include the presence of the body, see section \ref{sec:boundaryConditions}.
	
The velocity can be related to the vorticity using the Biot-Savart law as,

	\begin{equation}
	\mathbf{u}_{\omega} = \mathbf{K}\star\omega,
	\end{equation}
	
where the $\star$ represents convolution of the 2-D kernel $\mathbf{K}$ given by,

	\begin{equation}
	\mathbf{K} = \frac{1}{2\pi\left|\mathbf{x}\right|^2}\left(-x_2,x_1\right).
	\label{eq:GreensKernel}
	\end{equation}
	
\subsection{Discrete form of vorticity field}
The spatial discretization of the fluid domain is done through $N$ quadrature points. With the Biot-Savart law, we can treat these quadratures as discrete particles carrying the local quantities. The discrete vorticity field is given as,

	\begin{equation}
	\omega\left(\mathbf{x},t\right) \simeq \omega^h\left(\mathbf{x},t\right) = \sum_{p}\alpha_p\left(t\right)\delta \left[\mathbf{x}-\mathbf{x}_p\left(t\right)\right],
	\end{equation}

where $\alpha_{p}$ is the estimate of the circulation around the particle $\mathbf{x}_p$ with core size $\sigma$. We must note that $\omega^h$ is the discrete vorticity field and therefore in an approximation of the continuous vorticity field $\omega$. The discrete form of the velocity is therefore written as,

	\begin{equation}
	\mathbf{u} \simeq \mathbf{u}^h = \sum_p \mathbf{K}\left[\mathbf{x}-\mathbf{x}_p\left(t\right)\right]\alpha_p\left(t\right).
	\end{equation}
	
Thus the discrete vorticity field is an $N$-body problem inducing velocity on each and implicitly evolving the vorticity field. This is the main advantage of the vortex particle method as there are many efficient methods to evaluate the induced velocities. The $N$-body problem can be parallelized in GPUs, and furthermore the induced velocity calculations can be simplified using fast summation methods such as the \printAcron{Fast Multipole Method}{FMM}.
	
Like all the $N$-body problems, equation \ref{eq:GreensKernel} is an asymptotic kernel, and has a singularity when the particles approach each other. This can pose numerical instability when convecting the particle, and to overcome this, we can mollify the kernel, removing the singularity to create a smooth velocity field.

\subsection{Mollified vortex kernels}

A vortex particle with a mollified core, non-zero core-size, is referred to as a vortex blob. The advantage of a vortex blob is that the with its smooth distribution of the vorticity, the singularity disappear, and the numerical instability when the blobs get too close to each other, does not occur anymore. An ideal choice for a cutoff function that gives a smooth vorticity distribution is the Gaussian distribution, shown in figure \ref{fig:gaussianDistribution}.

	\begin{figure}[t]
	\centering
	\includegraphics[width=0.7\textwidth]{figures/lagrangian/gaussianKernel.pdf}
	\caption{The smoothing function $\zeta_{\sigma}$ for a gaussian distribution with $k=2$, $\sigma=1.0$.}
	\label{fig:gaussianDistribution}
	\end{figure}

Gaussian kernels satisfy the requirement for smooth distribution, decaying quickly away from the blob. It is defined as,
	
	\begin{equation}
	\zeta_{\sigma} = \frac{1}{k\pi\sigma^2}\exp\left(-\frac{\left|\mathbf{x}\right|}{k\sigma^2}\right),
	\end{equation}

where $k$ is either 1, 2 or 4 and it determines the width of the kernel; $\sigma$ is core-size of the blob. Note that smoothing function is chosen such that $\int \zeta = 1$, ensuring the conservation when mollified (i.e. the conservation of circulation). So using the smooth cut-off function $\zeta_{\sigma}$, the mollified Biot-Savart kernel $\mathbf{K}_{\sigma}$ is given as,	 

	\begin{equation}
	\mathbf{K}_{\sigma} = \mathbf{K} \star \zeta_{\sigma}.
	\end{equation}

The discrete mollified vorticity field, represented by vortex blobs is now defined as,

	\begin{equation}
	\omega^h\left(\mathbf{x},t\right) = \sum_p \alpha_p\left(t\right)\zeta_{\sigma}\left[\mathbf{x}-\mathbf{x}_p\left(t\right)\right],
	\label{eq:mollifiedVorticityField}
	\end{equation}

and similarly the discrete mollified velocity field is given as,

	\begin{equation}
	\mathbf{u}^h\left(\mathbf{x},t\right) = \sum_p \mathbf{K}_{\sigma}\left[\mathbf{x}-\mathbf{x}_p\left(t\right)\right]\alpha_p\left(t\right).
	\end{equation}

	\begin{figure}[b]
	\centering
	\includegraphics[width=0.4\textwidth]{figures/lagrangian/blobOverlap.pdf}
	\caption{Vortex blob with overlap $\sigma/h$}
	\label{fig:blobOverlap}
	\end{figure}

Koumoutsakos and Chorin \cite{Cottet2000a}, in order to have proper communication between the vortex particles, the particles needs to have an overlap. The overlap ratio is defined as,

	\begin{equation}
	\mathrm{overlap} = \frac{\sigma}{h},
	\label{eq:overlapRatio}
	\end{equation}

where $h$ is the nominal particle spacing. Figure \ref{fig:blobOverlap} shows the visual representation of the overlap ratio. If the particles fail to overlap, as confirmed by Koumoutsakos and Chorin \cite{Cottet2000a}, the vortex blobs will fail to represent the correct vorticity field. This problem occurs when blobs cluster together at regions of high flow strain. This localized clustering effect leads to lagrangian grid distorting, and has to be treading using remeshing schemes, covered in section \ref{subsec:remeshing}.


\subsection{Vortex blob initialization}
\label{subsec:vortexBlobInitialization}
Now the question arises on how should we initialize the particle's circulation strengths $\alpha_p$. The common approach that is used as a standard is to estimate the particles strength by the local properties,

	\begin{equation}
	\alpha_p = \omega_p\cdot h^2,
	\label{eq:particleCirculationAssignment}
	\end{equation}

	\begin{figure}[t]
	\centering
	\includegraphics[width=0.7\textwidth]{figures/lagrangian/particleInitialization.pdf}
	\caption{Mollified vorticity field of an arbitrary vorticity function with $\mathrm{overlap}=1.0$, $\sigma=0.19$, $h=0.19$. Vortex blob strength has been assigned by equation \ref{eq:particleCirculationAssignment}, sampling at exact vorticity [{\color{plotRed}{$\bullet$}}, red dot]. Figure depicts exact vorticity distribution $\omega$ [---, solid], vorticity field of each blob $\omega_i$ [{\color{darkgreen}{---}}, green dashed], the mollified vorticity field $\omega^h$ [- -, dashed].  }
	\label{fig:particleInitialization}
	\end{figure}

saying the particle carry the circulation of its local area. This might seem like a valid assumption as the circulation of a given area is the integral of the vorticity in the area, given by equation \ref{eq:definitionOfCirculation}, and it does satisfy the conservation of the circulation as all the circulation in the fluid is represented by the blobs.

However, this type of initialization suffers some accuracy when the vorticity field is regularizing the vorticity field using mollified gaussian kernels, equation \ref{eq:mollifiedVorticityField}. Barba and Rossi \cite{Barba2010}, has described this problem as gaussian blurring of the original vorticity field. Even though the particle have acquired the correct circulation strengths (i.e the local property), when evaluating the mollified vorticity field, we see that there is a mismatch in the evaluated vorticity field, figure \ref{fig:particleInitialization}. 

Another way of viewing this characteristic is say the conservation of circulation is only valid globally, but not locally. A common standard for recovering the initial vorticity field is perform the Beale's method \cite{Beale1988}.




\subsubsection*{Beale's Iterative Method}

The Beale's method is particle circulation processing scheme where the circulation of the particles are modified such that the mollified vorticity field matches the indented vorticity field. The recovery of the vorticity field is done by performing a discrete deconvolution,

	\begin{equation}
	\sum_j^N \beta_j \zeta_{\sigma}\left(\mathbf{x}_i-\mathbf{x}_j\right) = \omega_i,
		\end{equation}

where $\beta_j$ is the circulation of the particles at positions $\mathbf{x}_j$ such that it matches the exact vorticity $\omega_i$ at the position $\mathbf{x}_i$ that we are evaluating.  As we are try to solve for a $N$ unknown problem, we must set up a $N$ system of equations. Multiplying both sides with the area associated to the blobs, we get

	\begin{equation}
	\mathbf{A}_{ij} \beta_j = \alpha_i^{\mathrm{exact}},
	\end{equation}
	
where

	\begin{equation}
	\mathbf{A}_{ij} = \zeta_{\sigma}\left(\mathbf{x}_i - \mathbf{x}_j\right) \cdot h^2
	\end{equation}

is a $N \times N$ matrix containing the weights of the influence of each particle on each other. This matrix can be constructed by setting the $\Gamma$ to one and determine the induced vorticity on each other. Furthermore, we see that it is not feasible to directly invert the matrix when we have large set of blobs but most importantly as the matrix $\mathbf{A}$ is severly ill-conditioned \cite{Speck2011a}, it should not be directly inverted. Beale's proposition to this problem was to iteratively solve for the solution,

	\begin{equation}
	\beta_{j}^{n+1} = \alpha_i + \beta_i^n - \mathbf{A}_{ij}\cdot\beta_j^n
	\end{equation}
	
We see that with just two iterations, the error between the mollified and exact vorticity field reduces drastically, figure \ref{fig:bealesCorrection}. Koumoutsakos and Cottet \cite{Cottet2000a}, had shown that there was a drastic improvement in the velocity with just two to three iterations. However, we see that the cell vorticity of the blobs, directly evaluated from the particle strengths, equation \ref{eq:particleCirculationAssignment}, are more peaky and no longer matches the exact vorticity. 

During the hybrid coupling algorithm, we see that this is the central source of coupling error between the eulerian and the lagrangian method, section \ref{}. When performing the hybrid coupling, we need to recover the vorticity field transfered from the eulerian domain to the lagrangian domain in every step. So, beale's correction is not a viable solution for the hybrid method. Thus there is a need for an alternate method of recovering the vorticity field.

\todo{add the reference to hybrid}

	\begin{figure}[t]
	\centering
	\includegraphics[width=0.7\textwidth]{figures/lagrangian/bealesCorrection.pdf}
	\caption{Mollified vorticity field after two Beale's iteration, $\mathrm{overlap}=1.0$, $\sigma=0.19$, $h=0.19$. Figure depicts exact vorticity distribution $\omega$ [---, solid], vorticity field of each blob $\omega_i$ [{\color{plotGreen}{---}}, green dashed], the mollified vorticity field $\omega^h$ [- -, dashed].  }
	\label{fig:bealesCorrection}
	\end{figure}



\subsubsection{Convergence of particle discretization}

An alternate, temporary method to reduce the gaussian blurring of the vorticity field is to reduce the overlap (i.e. increase the overlap ratio) of the vortex blobs and to the increase the spatial resolution.
	
\begin{figure}[b]
        \centering
        \begin{subfigure}[b]{0.5\textwidth}
                \includegraphics[width=\textwidth]{figures/lagrangian/betterInitialization_h-crop.pdf}
                \caption{Convergence of $h$ with $\mathrm{overlap} = 1.0$}
                \label{fig:convergenceOfBlobsH}
        \end{subfigure}%
        ~ %add desired spacing between images, e. g. ~, \quad, \qquad etc.
          %(or a blank line to force the subfigure onto a new line)
        \begin{subfigure}[b]{0.5\textwidth}
                \includegraphics[width=\textwidth]{figures/lagrangian/betterInitialization_overlap-crop.pdf}
                \caption{Convergence of $\mathrm{overlap}$ with $h = 0.08$}
                \label{fig:convergenceOfBlobsOverlap}
        \end{subfigure}
        \caption{Convergence of vorticity by modifying the spatial resolution. Figure depicts exact vorticity field $\omega$ with [---, black] and various resolutions.}
        \label{fig:convergenceOfSpatialResolution}
\end{figure}	

Figure \ref{fig:convergenceOfSpatialResolution} shows mollified vorticity field results from modifying the spatial resolution parameters. Figure \ref{fig:convergenceOfBlobsH} shows the convergence of the mollified vorticity field $\omega^h$ to the exact vorticity field $\omega$ by reducing the nominal particle spacing $h$. The blobs have $\mathrm{overlap} = 1$ and so the blob core-size $\sigma$ is equal to $h$. We see that as you reduce the size of the blob and increase the number of particles, the mollified vorticity converges to the exact vorticity. Therefore, an alternate method of reducing the gaussian blurring is to increase the spatial resolution.

Furthermore, we could also adjust the $\mathrm{overlap}$ of the blobs, figure \ref{fig:convergenceOfBlobsOverlap}. The $\sigma$ and $h$ of the blob is $0.08$ and we see that increasing overlap number (i.e reducing the overlap), helps us to recover the original vorticity field. However, as explained by Koumoutsakos \cite{Cottet2000a}, if the overlap is too low, we lose the smooth recovery of the vorticity field. This is apparent when $\mathrm{overlap} = 2.0$, where we see that the mollified vorticity field is fluctuation.

Therefore, for the hybrid coupling, we set $\mathrm{overlap} = 1.0$ and maximize the spatial resolution at the coupling zone. 

\section{Convection of vortex blobs}

In the discrete of the convection equation \ref{eq:convectionEulerian} of the viscous-splitting algorithm, the is solved as system of ODEs, where

	\begin{equation}
	\frac{\mathrm{d}\mathbf{x}_p}{\mathrm{d}t} = \mathbf{u}\left(\mathbf{x}_p\right),
	\end{equation}
with
	\begin{equation}
	\frac{\mathrm{d}\alpha_p}{\mathrm{d}t} = 0.
	\end{equation}

As the diffusion is done at the next sub-step, we have to ensure that the circulation is conserved.


\subsection{Remeshing scheme: Treating lagrangian grid distortion}
\label{subsec:remeshing}
%
%%------------------------------------------------------------------------------------------------------
%%------------------------------------------------------------------------------------------------------
%%------------------------------------------------------------------------------------------------------

During the convection step, we see that another source of error in the vorticity field is the lagrangian grid distortion. As we have seen before, when the vortex blobs fails to overlap, we are no longer able to reconstruct the correct the vorticity field, figure \ref{fig:convergenceOfBlobsOverlap}. During the convection, due to the high strains in the fluid, the vortex blobs tent to clump together and creates regions where no vortex blobs are found, reducing the overlap of the blobs, figure \ref{fig:distortion}. 

%\begin{figure}[t]
%        \centering
%        \begin{subfigure}[b]{0.45\textwidth}
%                \includegraphics[width=\textwidth]{figures/lagrangian/distortion_a-crop.pdf}
%                \caption{$t = 0$}
%                \label{fig:distortion_a}
%        \end{subfigure}%
%        \qquad %add desired spacing between images, e. g. ~, \quad, \qquad etc.
%          %(or a blank line to force the subfigure onto a new line)
%        \begin{subfigure}[b]{0.45\textwidth}
%                \includegraphics[width=\textwidth]{figures/lagrangian/distortion_b-crop.pdf}
%                \caption{$t = 10$}
%                \label{fig:distortion_b}
%        \end{subfigure}
%        \caption{Lagrangian distortion of the vortex blobs after 100 steps. The initial vorticity field $\omega\left(\mathbf{x},0\right) = \exp\left(-12\left|\mathbf{x}\right|\right)$ with $\Delta t = 0.1$, $\sigma=0.02$ and $\mathrm{overlap} = 1.0$. Figure depicts the initial and the final distribution of the vortex blobs.}
%        \label{fig:distortion}
%\end{figure}

	\begin{figure}[!b]
	\centering
	\includegraphics[width=0.9\textwidth]{figures/lagrangian/distortion-crop.pdf}
    \caption{Lagrangian distortion of the vortex blobs after 100 steps. The initial vorticity field $\omega\left(\mathbf{x},0\right) = \exp\left(-12\left|\mathbf{x}\right|\right)$ with $\Delta t = 0.1$, $\sigma=0.02$ and $\mathrm{overlap} = 1.0$. Figure depicts $\textbf{(a)}$ the initial and $\textbf{(b)}$ the final distribution of the vortex blobs.}
    \label{fig:distortion}
	\end{figure}


We see that due to clustering of the vortex blobs, it fails to reproduce the correct vorticity field. A common strategy to overcome this problem is to remesh the vortex blobs to a uniform grid, so that we have a continuous vorticity field.

However, when transfering the vorticity from the old deformed grid to the new lagrangian uniform grid, we must satisfy the conservation laws of vorticity field. The interpolation methods is based on the conservation of linear impulse which directly implies the conservation of the total circulation \cite{Cottet2000a}. The transfer of the particle strengths is given as, 

	\begin{equation}
	\alpha_p = \sum_q\tilde{\alpha}_q W \left(\frac{x_p - \tilde{x}_q}{h}\right),	
	\end{equation}

where the strengths of the particles $\tilde{\alpha}_q$ of the distorted lagrangian grid $\tilde{x}_q$ is transfered to the regular lagrangian grid $x_p$ using the interpolation kernel, weighted $W$, giving us the remeshing particle strengths $\alpha_p$. The transfer of strengths of one particles to it's interpolation nodes can be seen in figure \ref{fig:interpolationGrid}.


	\begin{figure}[!b]
	\centering
	\includegraphics[width=0.4\textwidth]{figures/lagrangian/interpolationGrid.pdf}
	\caption{Remehsing of vortex blob ({\color{plotGreen}{$\bullet$}}, green) on the uniform grid defined by the $\left(4\times4\right)$ 2-D stencil.}
	\label{fig:interpolationGrid}
	\end{figure}

\subsubsection*{$\mathbf{M}^\prime_4$ interpolation kernel}
For lagrangian problem, we use the efficient interpolation kernel that has been used to reconstruct a smooth distribution interpolation, the $\mathrm{M}^{\prime}_4$ interpolation kernel, introduced by Monaghan \cite{Monaghan1985}. In one dimension it is given as,

	\begin{equation}
	{\mathrm{M'}_4}\left( {\xi} \right) =
	  \begin{cases}
	   {1 - \frac{{5{\xi ^2}}}{2} + \frac{{3{{\left| \xi  \right|}^3}}}{2}} & {\left| \xi \right|} < 1, \\
	   \frac{1}{2}{\left( {2 - \left| \xi  \right|} \right)^2}\left( {1 - \left| \xi  \right|} \right) & 1 \le {\left| \xi \right|} < 2,\\
	   0 & 2 \le \left| \xi \right|,
	  \end{cases}
	\label{eq:interpKernel}
	\end{equation}

where 

	\begin{equation}
	\xi = \frac{x_{\nu} - x_i}{h}
	\label{eq:xiEquation}
	\end{equation}

is the scale relative position of the particle $x_{\nu}$ to the $i^{\mathrm{th}}$ interpolation node $x_i$. The $\mathrm{M'}_4$ is a third-order accurate piecewise smooth B-spline kernel, where $m = 4$ giving it 4 support nodes, figure \ref{fig:interpolationKernel}. For the two dimensional problem that we have, the 2-D interpolation formula is simply tensor product of the 1-D interpolation kernel equation \ref{eq:interpKernel}, and results in $4^2 = 16$ support nodes, figure \ref{fig:interpolationGrid}.

	\begin{figure}[t]
	\centering
	\includegraphics[width=0.7\textwidth]{figures/lagrangian/interpolationKernel.pdf}
	\caption{$M'_4$ interpolation kernel, a third-order peicewise smooth B-spline kernel by Monaghan \cite{Monaghan1985}}
	\label{fig:interpolationKernel}
	\end{figure}

The interpolation kernel achieves the third-order accuracy as it also conserves the linear and the angular momentum of the vortex. Koumoutsakos \cite{Koumoutsakos1997} has investigated the drawback of the employing the remeshing strategy and have shown that there is approximately $4\%$ decay in enstrophy of the flow due to sub-grid dissipation. Note that enstrophy $ \mathcal{E}$, is defined as

% 4 % , give context, what time, how many remshings, say they are negligible for what we do.

	\begin{equation}
	\mathcal{E} = \frac{1}{2}\int_S \omega^2 dS
	\end{equation}
	
and is directly related to the kinetic energy of the fluid and gives and insight in the energy production and the dissipation of the fluid. Enstrophy is especially useful in turbulence flow investigation as it helps describe the energy cascade of the fluid.		

\section{Diffusion of Vortex Methods}
\label{sec:diffusionVM}

So far, we have dealth with unbounded Euler flow, where we disregarded the viscosity of the flow. However, for real flow we must take in account of the diffusion of the vorticity. Chorin's approach to deal with the viscous term was to employ the viscous splitting algorithm. The flow is segregated to inviscid and viscous component and during the second sub-step we deal with the diffusion of the vorticity, equation \ref{eq:vsa2}. The equation can again be solved as a system of ODEs, similar to the convection step, where we say,

	\begin{equation}
	\frac{\mathrm{d}\mathbf{x}_p}{\mathrm{d}t} = 0,
	\end{equation}
with
	\begin{equation}
	\frac{\mathrm{d}\alpha_p}{\mathrm{d}t} = \nu\Delta\alpha_p.
	\end{equation}

Therefore in the diffusive step, we fix the position of the vortex blobs and only have to modify the strengths of the particles to mimic the diffusion process. Chorin initially employed a random walk method, which generates and disperse vorticity using pseudo-random number algorithm \cite{Chorin1973}. However, this method suffers some limitations in accuracy. Since then \indexAcron{Particle Strength Exchange}{PSE} method \cite{Degond1989}, has been a common approach that has been used to treat diffusion.

\subsubsection*{Particle Strength Exchange}
The Particle Strength Exchange method, first proposed by Mas-Gallic \cite{Degond1989}, showed that diffusion can be treated for a particle method isotropic and anisotropic viscosity by approximating the diffusion operator (laplacian) with an integral operator and discretizing the operator using particles. The PSE can be seen as circulation correction method, where during the diffusion step of the viscous splitting algorithm, the strengths of the particle are corrected such that it accounts for the diffusion.
 
\subsubsection*{Vortex Redistribution Method}
An alternative method to simulate the diffusion is to use the \indexAcron{Vortex Redistribution Method}{VRM} \cite{Shankar1996}. The model simulates diffusion by distributing the fraction of circulation of the vortex blobs to each other satisfying the diffusion. The model is based on conserving the moments of the particles by satisfying a linear system of equations. The circulation of the particle are transfer to the nearby particles that are 

	\begin{equation}
	h_{\nu} = \sqrt{\nu\Delta t_d}
	\end{equation}

where $h_{\nu}$ is the diffusion distance and is directly related to the kinematic viscosity $\nu$ and the diffusive time-step $\Delta t_d$ of the simulation. Not that the diffusive time-step $\Delta t_d$ is equal to the convective time-step $\Delta t_c$ if the diffusion process is done during every time-step. However, we can easily adjust the diffusion time-step and perform diffusion at a multiple step of the convection.

This is vital as a VRM (and also the PSE) requires a search algorithm to determine the particles that are within the zone of influence. A direct evaluation required $\mathcal{O}\left(N^2\right)$ evaluation, however can be speed up to $\mathcal{O}\left(\log N\right)$ using search tree algorithm.

The downside of the this approach, as also for the standard remeshing approach is the global remeshing generates large computation data and scales with the number of particles $N$. Therefore for problems with large number of particles, a tree-structured remeshing would be more feasible strategy \cite{Winckelmans1996}.

\subsection{Modified remeshing for treating diffusion}
From further investigation of the VRM, we see that it is similar to remeshing strategy used to counter the lagrangian distortion during the convection process. Therefore Ghoniem and Wee \cite{Wee2006} has proposed to combine the remeshing and the diffusion. The application of this methodology was validated by Speck \cite{Speck2011a}. The diffusion is simulated by the modifying the interpolation kernel of the remeshing process. The key advantage of the modified remeshing method is that now it deals with the uniform remeshing grid helping us eliminating the computational expensive research requirement. The second advantage as shown by the authors is the simplicity. The method only requires a slight modification to the original remeshing tool.

During remeshing, the heat equation is satisfied by transferring the correct fraction of circulation to produce the proper amount of diffusion. The $\mathrm{M'}_4$ kernel was modified to treat the diffusion and is given by: 

\begin{equation}
{{{\rm{M'}}}_4}\left( {\xi ,c} \right) =
  \begin{cases}
   {1 - \frac{{5{\xi ^2}}}{2} + \frac{{3{{\left| \xi  \right|}^3}}}{2} - {c^2}\left( {2 - 9{\xi ^2} + 6{{\left| \xi  \right|}^3}} \right)} & {\left| \xi \right|} < 1, \\
   \frac{1}{2}{\left( {2 - \left| \xi  \right|} \right)^2}\left( {1 - \left| \xi  \right|} \right) - {c^2}{\left( {2 - \left| \xi  \right|} \right)^2}\left( {1 - 2\left| \xi  \right|} \right) & 1 \le {\left| \xi \right|} < 2,\\
   0 & 2 \le \left| \xi \right|,
  \end{cases}
\label{eq:modInterpKernel}
\end{equation}

where 

\begin{equation}
c^2 = \frac{\nu \Delta t_d}{h^2},
\label{eq:c2}
\end{equation}

and corresponds to the transfer quantity for diffusion. The addition terms in the interpolation kernel accounts for the diffusion process. When $c \rightarrow 0$, the interpolation kernel turns to the classical non-diffusion kernel. 

Similar to the VRM, we can perform the remeshing at a given multiple step $k_d$ of the convection step. However, we have an additional constraint on the diffusion time-step $\Delta t_d$, equation \ref{eq:c2}. Wee and Ghoniem \cite{Wee2006} also investigated the error growth and the stability properties of the interpolation kernel in the Fourier space and have determined that for $\mathrm{M'}_4$ interpolation kernel, we must satisfy

\begin{equation}
\frac{1}{6} \le c^2 \le \frac{1}{2}.
\label{eq:c2stability}
\end{equation}

to ensure amplification factor and the phase error does not grow. This will ensure the stability of the problem and will suppress any spurious oscillations and ensure that it is a non-negative interpolation kernel with non-negative redistribution fractions. 

However, we see that constraint on $c^2$ not only imposes a maximum $\Delta t_d$ but also a constraint on the minimum $\Delta t_d$. This means that in scenarios, the $\Delta t_d = k_d \cdot \Delta t_c$ and this might introduce sudden change in vorticity field. Therefore, during the coupling of the lagrangian and eulerian domains, we would like to diffuse the vorticity after every convection scheme.

\subsubsection*{Simple redistribution scheme}

The simple redistribution scheme based on the Shankar and Van Dommelen \cite{Shankar1996}, developed by Tutty \cite{2010arXiv1009.0166T}, makes it possible to remesh and diffuse the vorticity after every convection step, 

	\begin{equation}
	\alpha_i^{n+1} = \sum_k \alpha_k^n W_{ki}^n, 
	\end{equation}

where $W_{ki}^n$ is the fraction of circulation from vortex blob $k$ transferred to vortex blob $i$ by diffusion during the time step $n$. The fractions $W_{ki}^n$ are calculated by conserving vorticity, center of vorticity, linear, and angular momentum of the vortex blobs \cite{2010arXiv1009.0166T}. In two dimensional problem the redistribution fractions are simple tensors products of the $x,y$ one dimensional redistribution fractions,


	\begin{figure}[!b]
	\centering
	\includegraphics[width=0.7\textwidth]{figures/lagrangian/simpleRedistribution.pdf}
	\caption{One dimensional, Simple redistribution scheme, diffusing the vortex blobs to the four stencil points ($k=i-1,\dots,i+2$) with vortex blob positioned at $x_i \le x_{\nu} \le x_{i+1}$ and nominal blob spacing $h$.}
	\label{fig:simpleRedistribution}
	\end{figure}

	\begin{equation}
	W_{kl} = F_k G_l, \quad k = i-1,\cdots,i+2, \quad \l = j-1,\dots,j+2
	\end{equation}

giving it a 16 point stencil. The one-dimension redistribution fractions for $x$-direction is a linear combination of the two basis solution of the redistribution equation for conservations,

	\begin{equation}
	F_k = \left(1-\Delta\right)\cdot f_k + \Delta\cdot g_k, \quad k = i-1,\dots,i+2
	\end{equation}

having a four point stencil, figure \ref{fig:simpleRedistribution}. The basis solution of redistribution are 

	\begin{subequations}
	\begin{align}
	f_i &= 1 - 2\left(\frac{h_{\nu}}{h}\right)^2 - \xi^2\\
	f_{i-1} &= \frac{1}{2}\left(1-f_i-\xi\right)\\
	f_{i+1} &= \frac{1}{2}\left(1-f_i+\xi\right)
	\end{align}
	\end{subequations}
and 	
	\begin{subequations}
	\begin{align}
	g_{i+1} &= 1 - 2\left(\frac{h_{\nu}}{h}\right)^2 - \xi_1^2\\
	g_{i} &= \frac{1}{2}\left(1-g_{i+1}-\xi_1\right)\\
	g_{i+2} &= \frac{1}{2}\left(1-g_{i+1}+\xi_1\right)
	\end{align}
	\end{subequations}

where $\xi$ is given by equation \ref{eq:xiEquation}, $\xi_1 = \xi - 1$ are the distances between the $k^{\mathrm{th}}$ stencil nodes $x_k$ and the vortex blob that is to be diffused with $x_i \le x_{\nu} \le x_{i+1}$. Note, $f_k$ and $g_k$ is zero for all the other $k$. In the above equation, $h_{\nu}$ is the characteristic diffusion distance over the time $\Delta t_d$, 

	\begin{equation}
	h_{\nu} = \sqrt{\Delta t_d \cdot \nu}.
	\end{equation}
	
	
The only constraint imposed  for positive redistribution fraction is

	\begin{equation}
	\frac{h_{\nu}}{h} < \frac{1}{\sqrt{2}}.
	\end{equation}
	
giving us the maximum time-step size constraint of
	\begin{equation}
	\Delta t_d < \frac{h^2}{2\nu}.
	\end{equation}

So now, we are able to perform diffusion, together with the convection step (i.e $k_d = 1$).

\section{Boundary conditions at solid boundary}
\label{sec:boundaryConditions}

So far, we have only dealt with unbounded flow. During bounded flow simulation, we must impose addition constraint of the boundary to the simulation to simulate any flow about a geometry. From Helmholtz decomposition, we can have decompose the velocity field to the rotation and the irrotation component, equation \ref{eq:helmholtz}. With the Helmholtz decomposition, we can use the potential component to prescribe the boundary conditions at the solid wall boundary,
	\begin{equation}
	\mathbf{u}_{\phi} = \nabla\Phi.
	\end{equation}

The incompressibility constraint results in a Laplace's equation for the potential field and unique solution is obtained by enforcing the wall boundary conditions,
	\begin{equation}
	\mathbf{u}_b\cdot\mathbf{\hat{n}} = \left(\mathbf{u}_{\omega} + \nabla\Phi\right) \cdot \mathbf{\hat{n}},
	\label{eq:potentialBC}
	\end{equation}
and is defined as enforcing the no-through flow at the solid boundary wall, moving at $\mathbf{u}_b$. Note that the $\mathbf{\hat{n}}$ is the normal vector of the solid boundary. A classical approach for determine the solution to the Laplace's equation is by Green's function formulation. This approach required a singularity distribution over the body resulting in the appropriate boundary condition. Doublets and/or source panels are used to attain the required potential such that equation \ref{eq:potentialBC} is satisfied.

\subsubsection{Linked boundary conditions}

However Koumoutsakos, Leonard and Pepin \cite{Koumoutsakos1994b}, have suggested to enforce the boundary conditions through vortex sheets. The alternative approach of enforcing the solid boundary condition is not to decompose the velocity field into potential and rotational but to consider the solid boundary as an extension of the vorticity field through vortex sheets $\gamma$, figure \ref{fig:noSlipVorticityField}. Due to the non-zero tangential velocity at the surface, a sudden discontinuity in the velocity field can be considered as vortex sheet. Therefore, now to enforce the boundary conditions of the solid wall, we must satisfy the no slip velocity at the boundary,
	\begin{equation}
	\mathbf{u}\cdot\mathbf{\hat{s}} = \mathbf{u}_b\cdot\mathbf{\hat{s}}.
	\end{equation}

Koumoutsakos \cite{Koumoutsakos1993b} only relies on the vortex sheet to enforce the no-slip velocity as no-slip boundary condition directly satisfies the no-through boundary conditions, also known as the linked boundary conditions. This was also proven by Shiels \cite{Shiels1998} and further investigated by Cooper, Mar and Barba \cite{Cooper2009b} and shown that vortex sheet is the only necessary singularity element required to satisfy both the boundary conditions. Therefore, enforcing the no-slip boundary condition directly satisfies the no-through constraint at the surface.
	\begin{figure}[t]
	\centering
	\includegraphics[width=0.6\textwidth]{figures/lagrangian/noSlipVorticityField.pdf}
	\caption{Extended vorticity field consisting of vorticity in the fluid and vortex sheet distribution around the body.}
	\label{fig:noSlipVorticityField}
	\end{figure}

\subsection{Boundary integral equations}
Thus the decomposed velocity field can be summarized as
	\begin{equation}
	\mathbf{u} = \mathbf{u}_{\omega} + \mathbf{u}_{\gamma} + \mathbf{u}_{\infty}
	\end{equation}
where the $\mathbf{u}_{\gamma}$ denotes the velocity filed induced by the vortex sheet. Applying the no-slip boundary conditions, we can say that
	\begin{equation}
	\left(\mathbf{u}_{\mathrm{ext}} + \mathbf{u}_{\gamma}\right)\cdot\mathbf{\hat{s}} = \mathbf{u}_b \cdot \mathbf{\hat{s}}
	\label{eq:kinematicBCofVSOutside}
	\end{equation}
where $\mathbf{u}_{\mathrm{ext}} = \mathbf{u}_{\omega} + \mathbf{u}_{\infty}$ is the velocity field induced from domain external of the body and the vortex sheet. For the tangential boundary condition, for a well-conditioned system of equations, the induced velocity from the vortex sheet can be summarized as  
	\begin{equation}
	\left(\mathbf{u}_{\mathrm{ext}} - \mathbf{u}_b\right) \cdot \mathbf{\hat{s}} = \mathbf{u}_{\gamma}\cdot\mathbf{\hat{s}}.
	\label{eq:kinematicBCofVS}
	\end{equation}

The equation states that underneath the vortex sheet, we must have a vortex sheet inducing the velocity field $\mathbf{u}_{\gamma}$ to counter the slip velocity $\mathbf{u}_{\mathrm{slip}} = \left(\mathbf{u}_{\mathrm{ext}} - \mathbf{u}_b\right)$ such that we satisfy the no-slip kinematic boundary conditions. Note that, $\mathbf{u}_{\gamma}$ of equation \ref{eq:kinematicBCofVS}, is negative of equation \ref{eq:kinematicBCofVSOutside} as we looking under the vortex sheet. Koumoutsakos \cite{Koumoutsakos1993b}, expressed the relation of the vortex sheet strengths to the no-slip boundary condition at the surface of the body (inside the body) through the Fredholm integral equation of the second kind,
	\begin{equation}
	-\frac{\gamma\left(s\right)}{2} + \frac{1}{2\pi}\oint\frac{\partial}{\partial n}\left[\log\left|\mathbf{x}\left(s\right)-\mathbf{x}\left(s'\right)\right|\right]\gamma\left(s'\right)ds'= \mathbf{u}_{\mathrm{slip}}\cdot\mathbf{\hat{s}}.
	\label{eq:fredholmIntegral2ndKind}
	\end{equation}
		
The \indexAcron{Left Hand Side}{LHS} of the equation states at the point $s$, the velocity discontinuity is due to the vortex sheet at the point and the induced velocity of all the other vortex sheet acting on the point. 

However, the equation \ref{eq:fredholmIntegral2ndKind} is not unique and accepts arbitrary solution for the vortex sheet strengths, therefore we must imposed an additional constraint on the strength of the vortex sheet. The addition constraint is a constraint on the net circulation of the vortex sheet. As the vortex sheet is considered as an extension to the vorticity field, we could say that the net circulation of the vortex panels	is the circulation that was not captured by the vortex blobs, figure \ref{fig:extendedVorticityField}. As vortex blobs are not available very-near the body, it is not possible for the vortex blobs to resolve the high gradient vorticity at the boundary. Therefore, all the vorticity in the vortex sheet domain must be captured by the vortex sheet.
	
	\begin{figure}[t]
	\centering
	\includegraphics[width=0.8\textwidth]{figures/lagrangian/extendedVorticityField.pdf}
	\caption{Extended vorticity field: Vortex sheet being an extension to the vorticity field (resolved by the vortex blobs) which is able to fully resolve the boundary vorticity}
	\label{fig:extendedVorticityField}
	\end{figure}	
	
When considering a moving boundary, we must also take into account of the circulation of the body due to its motion. The net circulation of the problem is given as
	\begin{equation}
	\Gamma = \Gamma_{\omega} + \Gamma_{\gamma} + \Gamma_{b} = 0,
	\end{equation}	
where $\Gamma_{\omega}$ is the circulation of the vorticity in the fluid (i.e. the vortex blobs), $\Gamma_{\gamma}$ is the wall bounded circulation (i.e. vortex sheets),
	\begin{equation}
	\Gamma_{\gamma} = \oint\limits_S\gamma\left(s\right)\ d s,
	\end{equation}	
and the $\Gamma_b$ is the circulation of the moving body. The circulation inside the body can be considered also be considered as an extension to the vorticity field, where the body is filled with uniform vorticity due to the rotation of the body. Therefore the circulation of a moving body can calculated simply integrating the ``vorticity'' inside the body
	\begin{equation}
	\Gamma_b = \iint\limits_{body} \nabla \times \mathbf{u}_b \ d A.
	\end{equation}	

So the constraint imposed on the net circulation of the vortex sheets is given as,
	\begin{equation}
	\Gamma_{\gamma} = - \left(\Gamma_{\omega} + \Gamma_b\right).
	\end{equation}	

Now, in a pure lagrangian, we must transfer the vorticity generated from the body to the fluid. This is typically done by diffusing the vorticity of the vortex on the fluid, however in our hybrid coupling method, we can use the eulerian domain to introduce the vorticity into the fluid. The eulerian domain acts as the near-wall solver \cite{Daeninck2006}, and the strengths of the particles is interpolated from the eulerian domain, section \ref{}.\todo{CiTe Hybrid sectin}

\subsection{Panel method for treating no-slip boundary condition}
Equation \ref{eq:fredholmIntegral2ndKind} is solved by discretizing the body into $M$ vortex panels giving us a system of equation with can used to determine the $M$ unknowns of the strength of the vortex panels. The method refered as panel method has been greatly summarized by Katz and Plotkin \cite{Katz2001a}. 

Katz and Plotkins have shown several types of panel distributions with various orders of accuracy, from $0^{\mathrm{th}}$
order point vortex or up to $2^{\mathrm{nd}}$ order varying panel strength curvatured distribution. For this project, we have used a constant-strength vortex distribution that discretized the vortex sheet into straight segments, classified as \indexAcron{Constant-Strength Vortex Method}{CSVM}.

Panel methods are constructed by discretizing the integral equation and forming a system of equations to solve the $M$ unknowns of the vortex panel,

	\begin{equation}
	\underbrace{\begin{pmatrix}
	-\frac{1}{2} & a_{12} & \cdots & a_{1M}\\ 
	a_{21} & -\frac{1}{2} & \cdots & a_{2M}\\
	\vdots & \vdots & \ddots & \vdots\\ 
	a_{M1} & a_{M2} & \cdots & -\frac{1}{2}
	\end{pmatrix}}_{\mathbf{A}_{MM}} \underbrace{\begin{pmatrix}
	\gamma_{1}\\ \gamma_{2}\\
	\vdots\\
	\gamma_M\\
	\end{pmatrix}}_{\vec{\gamma}} = \underbrace{\begin{pmatrix}
	\mathrm{RHS}_1\\ 
	\mathrm{RHS}_2\\ 
	\vdots\\
	\mathrm{RHS}_M
	\end{pmatrix}}_{\overrightarrow{\mathrm{RHS}}}
	\label{eq:vortexSheetSystemofEquations}
	\end{equation}


where $A_{MM}$ contains the weights of the influence of the vortex panels $\vec{\gamma}$ on each other and the $\overrightarrow{\mathrm{RHS}}$ is

	\begin{equation}
	\mathrm{RHS} = \mathbf{u}_{\mathrm{slip}}\cdot\mathbf{\hat{s}}
	\end{equation}
	
is the boundary condition to the system of equations. In addition, we have another constraint on the net circulation of the vortex panels and in discrete from we say that,

	\begin{equation}
	\sum_{i}^{M} \gamma_i\Delta s = \Gamma_{\gamma}
	\end{equation}	

and results in a $M+1$ system of equations for solving the $M$ unknown strengths of the vortex panels,

	\begin{equation}
	\underbrace{\begin{pmatrix}
	-\frac{1}{2} & a_{12} & \cdots & a_{1M}\\ 
	a_{21} & -\frac{1}{2} & \cdots & a_{2M}\\
	\vdots & \vdots & \ddots & \vdots\\ 
	a_{M1} & a_{M2} & \cdots & -\frac{1}{2}\\
	\Delta s_1 & \Delta s_2 & \cdots & \Delta s_M
	\end{pmatrix}}_{\mathbf{B}_{\left(M+1\right)M}} \underbrace{\begin{pmatrix}
	\gamma_{1}\\ \gamma_{2}\\
	\vdots\\
	\gamma_M\\
	\end{pmatrix}}_{\vec{\gamma}} = \underbrace{\begin{pmatrix}
	\mathrm{RHS}_1\\ 
	\mathrm{RHS}_2\\ 
	\vdots\\
	\mathrm{RHS}_M\\
	\Gamma_{\gamma}
	\end{pmatrix}}_{\overrightarrow{\mathrm{RHS}}}
	\end{equation}

However, as we have an additional constraint on the net strength of the panels, we have $M+1$ set of equations with $M$ unknowns giving us a overdetermined problem. The approach to solve such a problem is either by using a \indexAcron{Least-Square solution method}{LSTSQ}, or introducing a new unknown or as used by Katz, eliminating an equation. Enforcing the no-slip boundary condition at each panel location is our vital criteria and therefore, elimination of an equation is not a viable strategy and so the LSTSQ method was utilized for the project.

\subsubsection{Constant-Strength Vortex Method}

The Constant-Strength vortex method ({\color{darkblue}CSVM}) is based on the flat (straight) discretization of the vortex sheet, where the panel have constant vortex strength as per definition. To solve the strengths of the panel problem, we enforce the dirichlet velocity boundary conditions at the collocation point $x_{cp}$, which is located just below the vortex sheet, figure \ref{fig:vortexPanelDefinition}. The coefficient $a_{ij}$ of the influence matrix $\mathbf{A}$ is defined as
	\begin{equation}
	a_{ij} = \mathbf{\hat{u}}_{ij} \cdot \mathbf{\hat{t}}_i,
	\end{equation}
		
and is the tangential influence coefficient of $j^{\mathrm{th}}$ panel on the $i^{\textrm{th}}$ panel. Therefore, induced velocity $\mathbf{\hat{u}}_{ij} = \left(\hat{u},\hat{v}\right)_{ij}$ is the unit induced velocity of the $j^{\mathrm{th}}$ panel on to the collocation points of $i^{\mathrm{th}}$ panel, where the vortex panels have unit strength (i.e $\hat{\gamma}_i = 1$). In general, the induced velocity of the vortex panels are calculated in the local panel coordinates, figure \ref{fig:panelDefinitions}, and the transformation from the local panel coordinate $(x',y')$ to the global coordinates systems $(x,y)$ is given by 

	\begin{equation}
	\begin{bmatrix}
	u_{ij}\\
	v_{ij}\\
	\end{bmatrix} = \begin{bmatrix}
	\cos\alpha_j & \sin\alpha_j \\
	-\sin\alpha_j & \cos\alpha_j
	\end{bmatrix} \cdot \begin{bmatrix}
	u'_{ij}\\
	v'_{ij}
	\end{bmatrix}
	\end{equation}

The induced velocity of the vortex panel $j$ on the collocation point $i$ is given as

	\begin{subequations}
	\begin{align}
	u'_{ij} &= \frac{\gamma_j}{2\pi}\left[\tan^{-1}\frac{y'_i-y'_{j,2}}{x'_i-x'_{j,2}} - \tan^{-1}\frac{y'_i-y'_{j,1}}{x'_i -x'_{j,1}}\right],\\
	v'_{ij} &= -\frac{\gamma_j}{4\pi}\ln\frac{\left(x'_i-x'_{j,1}\right)^2 + \left(y'_i-y'_{j,1}\right)^2}{\left(x'_i-x'_{j,2}\right)^2+\left(y'_i-y'_{j,2}\right)^2}
	\end{align}
	\end{subequations}

\begin{figure}[t]
        \centering
        \begin{subfigure}[b]{0.5\textwidth}
                \includegraphics[width=\textwidth]{figures/lagrangian/panelCoordinateDefinition.pdf}
                \caption{Panel discretization of the body in the global cartesian coordinates system $\left(x,y\right)$ and local panel coordinates rotated by $\alpha_i$.}
                \label{fig:panelCoordinateDefinition}
        \end{subfigure}%
        ~ %add desired spacing between images, e. g. ~, \quad, \qquad etc.
          %(or a blank line to force the subfigure onto a new line)
        \begin{subfigure}[b]{0.5\textwidth}
                \includegraphics[width=\textwidth]{figures/lagrangian/vortexPanelDefinition.pdf}
                \caption{Constant strength vortex panel in the local panel coordinate system $\left(x',y'\right)$ inducing velocity on the point $P$.}
                \label{fig:vortexPanelDefinition}
        \end{subfigure}
        \caption{Vortex panel's global \textbf{(a)} and local \textbf{(b)} coordinates system definition as defined by Katz and Plotkins \cite{Katz2001a}.}
        \label{fig:panelDefinitions}
\end{figure}	
	
where $(x'_1,y'_1)_j$ and $(x'_2,y'_2)_j$ are the coordinates of the panel start and end point in its local panel coordinate system. Note that the self-induction of the vortex panel (when $i=j$), the influence coefficient becomes $a_{ij} = -1/2$, and can be seen in the diagonal terms of equation \ref{eq:vortexSheetSystemofEquations}. So, by taking $\hat{\gamma}_i = 1$, we are able to construct the influence coefficients of the influence matrix $\mathbf{A}$ and can solve the strengths of the panel, 
	\begin{equation}
	\mathbf{B}\cdot\gamma = \mathrm{RHS},
	\end{equation}
using the LSTSQ method. 

	\begin{figure}[b]
	\centering
	\includegraphics[width=0.6\textwidth]{figures/lagrangian/twoPanelBodies.pdf}
	\caption{twoPanelBodies}
	\label{fig:twoPanelBodies}
	\end{figure}

If we are dealing with multiple geometries, figure \ref{fig:twoPanelBodies}, the panel method can be easily extended by constructing a global influence matrix, 

	\begin{equation}
	\underbrace{\begin{pmatrix}
		c_{a_1a_1} & \cdots & c_{a_1a_N} & c_{a_1b_1} &\cdots & c_{a_1b_M}\\
		\vdots & \ddots & \vdots & \vdots &\ddots & \vdots\\
		c_{a_Na_1} & \cdots & c_{a_Na_N} & c_{a_Nb_1} &\cdots & c_{a_Nb_M}\\
		c_{b_1a_1} & \cdots & c_{b_1a_N} & c_{b_1b_1} &\cdots & c_{b_1b_M}\\
		\vdots & \ddots & \vdots & \vdots &\ddots & \vdots\\
		c_{b_Ma_1} & \cdots & c_{b_Ma_N} & c_{b_Mb_1} &\cdots & c_{b_Mb_M}\\
		\Delta s_{a_1} & \cdots & \Delta s_{a_N} & 0 & \cdots & 0\\
		0 & \cdots & 0 & \Delta s_{b_1} & \cdots & \Delta s_{b_M}\\
	\end{pmatrix}
	\begin{pmatrix}
		\gamma_{a_1}\\
		\vdots\\
		\gamma_{a_N}\\
		\gamma_{b_1}\\
		\vdots\\
		\gamma_{b_M}\\
	\end{pmatrix}}_{\begin{pmatrix}
						C_{aa} & C_{ab} \\
						C_{ba} & C_{bb} \\
						\Delta s_a & 0\\
						0 & \Delta s_b \\
					\end{pmatrix} \begin{pmatrix}
								\gamma_{a}\\
								\gamma_{b}\\
							\end{pmatrix}} 
	= 
	\underbrace{\begin{pmatrix}
		\mathrm{RHS}_{a_1}\\
		\vdots\\
		\mathrm{RHS}_{a_N}\\
		\mathrm{RHS}_{b_1}\\
		\vdots\\
		\mathrm{RHS}_{b_M}\\
		\Gamma_{\gamma,a}\\	
	\Gamma_{\gamma,b}
	\end{pmatrix}}_{ 
			\begin{pmatrix}
				\mathrm{RHS}_{a}\\
				\mathrm{RHS}_{b}\\
				\Gamma_{\gamma,a}\\	
				\Gamma_{\gamma,b}
			\end{pmatrix}}
	\end{equation}

where the diagonal matrices ($C_{aa}$, $C_{bb}$) are the self-induction matrix of the panel body and the non-diagonal terms ($C_{ab}$, $C_{ba}$) are the inter-induction matrix containing the panel influence of $b\rightarrow a$ and $a\rightarrow b$ respectively. The final two rows of the induction matrix contains the additional circulation constraint for each body.


%	\begin{equation}
%	\begin{pmatrix}
%	\mathrm{ab} & \mathrm{ab}\\
%	\mathrm{ba} & \mathrm{bb}\\
%	\Delta s_a & 0\\
%	0 & \Delta s_b
%	\end{pmatrix}
%	\begin{pmatrix}
%	\gamma_a\\
%	\gamma_b	
%	\end{pmatrix} = \begin{pmatrix}
%		\mathrm{RHS}_a\\
%		\mathrm{RHS}_b\\
%		\Gamma_{\gamma,a}\\	
%		\Gamma_{\gamma,b}
%		\end{pmatrix}
%	\end{equation}

%
\subsection{Error analysis of panel method}
The validation of the panel method was done by performing a convergence study of a cylinder. The vortex panels where used to simulate a potential flow around a cylinder and the solution of the panels was compared with the analytical solutions.

%	\begin{table}[b]
%	    \centering
%	    \begin{tabular}{ l c l }
%	        \hline
%	        Parameters\T\B	            & Value 	& Unit    \\
%	        \hline
%	        $R$\T                     	& $1$	    & \si{m} \\
%	        $\mathbf{u}_{\infty}$ 		& $\left[1, 0\right]$  	& \si{m.s^{-1}} \\
%	        $N_{\mathrm{panels}}$\B     & $100$  	& -   \\
%	        \hline
%	    \end{tabular}
%	    \caption{Panel study parameters}
%	    \label{tab:panelParams}
%	\end{table}

%	\begin{table}[b]
%	    \centering
%	    \caption{Panel study parameters Panel study parameters Panel study parameters}
%	    \begin{tabular}{ l c l }
%	    	\toprule
%	        Parameters\T\B	            & Value 	& Unit    \\
%	        \midrule
%	        $R$\T                     	& $1$	    & \si{m} \\
%	        $\mathbf{u}_{\infty}$ 		& $\left[1, 0\right]$  	& \si{m.s^{-1}} \\
%	        $N_{\mathrm{panels}}$\B     & $100$  	& -   \\
%			\bottomrule
%	    \end{tabular}
%	    
%	    \label{tab:panelParams}
%	\end{table}	
%	
	\ctable[
	    caption = {Panel study parameters},
	    label   = {tab:panelParams},
	    pos = b,
	]{lll}{}{\FL
	Parameters 				& Value 			& Description \ML
	$R$  					& 1 \si{m} 			& Radius of cylinder\\
	$\mathbf{u}_{\infty}$	& 1 \si{m.s^{-1}}	& Free-stream velocity\\
	$N_{\mathrm{panels}}$	& 100				& Number of panels\LL}	
	
	

To test the solution of the vortex panels with the analytical solution, the problem was first run for the parameters in the table \ref{tab:panelParams}. The velocity field of the potential flow solution is shown in figure \ref{fig:panelCylinder_velocityField}. The figure shows the norm of the velocity, and we see that it shows the velocity field of a potential flow solution, with an infinitely thin boundary layer, stagnating to zero velocity inside the body.

	\begin{figure}[t]
	\centering
	\includegraphics[width=0.7\textwidth]{figures/lagrangian/panelCylinder_velocityField.pdf}
	\caption{Panel method solution: Potential flow velocity field around unit cylinder. The figure depicts $\left\Vert\mathbf{u}\right\Vert$ with zero velocity inside the body.}
	\label{fig:panelCylinder_velocityField}
	\end{figure}

The jagged velocity field around the surface of the cylinder is simply due to the sampling resolution of the field; For higher resolution, this will not be there. In order to determine the accuracy of the solution, the velocity field of the panel solution was compared with the analytical solution. The analytical velocity field around a cylinder is given as,
	\begin{subequations}
	\begin{align}
	u_r &= u\left(1 - \frac{R^2}{r^2}\right)\cos\theta\\
	u_{\theta} &= -u\left(1+\frac{R^2}{r^2}\right)\cos\theta
	\end{align}
	\label{eq:potentialCylinderAnalytical}
	\end{subequations}	
where $u_r$ and $u_{\theta}$ are the radial and the angular velocity respectively. The equation \ref{eq:potentialCylinderAnalytical} is a function of the radius from the center of the cylinder (in our case $r_0 = [0, 0]$) and the radius of the cylinder $R$. 

\begin{figure}[!b]
        \centering
        \begin{subfigure}[b]{0.5\textwidth}
                \includegraphics[width=\textwidth]{figures/lagrangian/panelCylinder_versusAnalytical.pdf}
                \caption{Comparison of the velocity field.}
                \label{fig:panelCylinder_versusAnalytical}
        \end{subfigure}%
        ~ %add desired spacing between images, e. g. ~, \quad, \qquad etc.
          %(or a blank line to force the subfigure onto a new line)
        \begin{subfigure}[b]{0.5\textwidth}
                \includegraphics[width=\textwidth]{figures/lagrangian/panelCylinder_error.pdf}
                \caption{Error in velocity field}
                \label{fig:panelCylinder_error}
        \end{subfigure}
        \caption{Comparison of the velocity field along the $y$-axis $0\rightarrow10$. Figure \textbf{(a)} shows both the solutions, the numerical $\left\Vert\mathbf{u}^h\right\Vert$ [solid blue, {\color{plotBlue}{---}}] and the analytical solution [solid black, ---]. Figure \textbf{(b)} shows the relative error $\epsilon$ between the solution, given by equation \ref{eq:panelRelativeError}}
        \label{fig:panelCylinderComparision}
\end{figure}	

The velocity field of the panel was compared with this analytical solution along the y-axis from $y=0$ to $y=10$, figure \ref{fig:panelCylinder_versusAnalytical}. Comparing the solutions of the plot we see that the solution of the vortex panels and the analytical potential flow solution matches everywhere except at the surface. This is correct because the potential flow solution has a slip velocity (i.e non-zero velocity) at the surface of the body, whereas the vortex panels solves for a no-slip boundary condition at the collocation points of the surface. This explains the sudden drop of the velocity from two to zero at the surface.	

The figure \ref{fig:panelCylinder_error} shows the relative error $\epsilon$ between the numerical and the analytical solution,
	\begin{equation}
	\epsilon = \frac{\left\Vert\mathbf{u}-\mathbf{u}^h\right\Vert}{\left\Vert\mathbf{u}\right\Vert}
	\label{eq:panelRelativeError}
	\end{equation}
	
where $\mathbf{u}$ is the analytical solution and the $\mathbf{u}^h$ is the numerical (panel method) solution. Ignoring the solution right at the surface ($r=R$), we see that the error between the numerical and the analytical solution reduces from $\epsilon=\num{5e-3}\rightarrow \num{8e-5}$ as we go from $r=1\rightarrow10$. This behavior of the error tells us that the solution of the constant-strength vortex panels gets more accurate as we go further away from the panels; right next to the panels, we have the largest error. This is because the vortex panels discretizes the body using a first-order approximation (straight panels) and also discretizes the vortex sheet strength using a first-order approximation. 

\subsubsection*{Convergence analysis}

The convergence analysis of the vortex panels shows that the panels that we are employing is indeed a first-order method as the error converges at $\mathcal{O}\left(N\right)$, figure \ref{fig:panelCylinder_convergence}.

	\begin{figure}[!t]
	\centering
	\includegraphics[width=0.7\textwidth]{figures/lagrangian/panelCylinder_convergence_compressed.pdf}
	\caption{Convergence plot of the constant-strength straight vortex panels. The figures depicts the reduction is error at $\mathcal{O}\left(N\right)$.}
	\label{fig:panelCylinder_convergence}
	\end{figure}

%\newpage
%\section{Simulation acceleration techniques}
%\label{sec:sat}
%%
%\subsection{Fast multi-pole Method}
%%
%\subsection{Parallel computation in GPU}
%
\section{Validation of Lagrangian method}
Note that during this validation study, we are unable to validate the proper handling of the Lagrangian boundary conditions. This is because, we have only defined the vorticity generation from the boundary in the Eulerian domain and we neglected the vorticity production from the vortex panels, due to the natural of the coupling method, we are unable to validate the proper coupling of vortex panels with vortex blobs. Therefore, validation study for the Lagrangian method is done separately, ensuring no-through flow on vortex panels, and ensuring proper handling of vorticity with vortex blobs.

In order to verify and validate the vortex blobs, we use the analytical solution of the Lamb-Oseen vortex evolution. The validation of the lagrangian method was done by comparing the results of the Lamb-Oseen vortex and the analyzing the convection of the Clercx-Bruneau dipole. 

\subsection*{Lamb-Oseen vortex}

\begin{figure}[!t]
        \centering
        \begin{subfigure}[b]{0.5\textwidth}
                \includegraphics[width=\textwidth]{figures/lagrangian/lambOseen_vorticityDistribution_compressed.pdf}
                \caption{Vorticity field}
                \label{fig:lambOseen_vorticityDistribution}
        \end{subfigure}%
        ~ %add desired spacing between images, e. g. ~, \quad, \qquad etc.
          %(or a blank line to force the subfigure onto a new line)
        \begin{subfigure}[b]{0.5\textwidth}
                \includegraphics[width=\textwidth]{figures/lagrangian/lambOseen_velocityDistribution_compressed.pdf}
                \caption{Velocity Field}
                \label{fig:lambOseen_velocityDistribution}
        \end{subfigure}
        \caption{Lamb-Oseen \textbf{(a)} vorticity distribution, and \textbf{(b)} velocity distribution. $\Gamma_c = 1$, $\tau=\num{2e-3}$.}
        \label{fig:lambOseen_distributions}
\end{figure}

The Lamb-Oseen vortex is a simple solution of unbounded laminar Navier-Stokes equation of a vortex core diffusing as time passes. It was first demonstrate by Lamb \cite{} and Oseen \cite{}. The vorticity distribution $\omega$ of the core at a given time is defined as,

	\begin{equation}
	\omega\left(\mathbf{x},\tau\right) = \frac{\Gamma_c}{4\pi\tau} \exp\left(-\frac{r^2}{4\tau}\right),
	\end{equation}

and is a function of core strength $\Gamma_c$, the scaled viscous time $\tau$, and distance from the core center $r$. At $\tau=0$, the Lamb-Oseen vorticity distribution is a Dirac delta function and diffusion as time progresses. Figure \ref{fig:lambOseen_vorticityDistribution} shows the vorticity distribution of the Lamb-Oseen vortex with core strength $\Gamma_c=1$ at scaled viscous time $\tau=\num{2e-3}$. Note, the scaled viscous time is defined as $\tau \equiv \nu t$. The velocity field of this core is given as 

	\begin{subequations}
	\begin{align}
	u_{\theta} &= \frac{\Gamma_c}{2\pi r} \left[1-\exp\left(-\frac{r^2}{4\tau}\right)\right]\\
	u_r &= 0
	\end{align}
	\end{subequations}

where $u_{\theta}$ is the circumferential velocity and the radial velocity $u_r$ is zero. This can be seen on figure \ref{fig:lambOseen_velocityDistribution}. 

To determine whether the lagrangian method performs according to theory, this analytical solution will be used to verify and then validate the solution.

\subsection{Evolution of Lamb-Oseen vortex}

The lagrangian method ran the case of Lamb-Oseen vortex simulation according to the parameters tabulated in table \ref{tab:lambOseenParams}. The problem was initialized by discretizing the vorticity field of the Lamb-Oseen $\Gamma_c=1$ and $\nu=\num{5e-4}$ at $\tau_0 = \num{2e-3}$. The vorticity field was discretized from $(x,y)$ - domain $\left[-0.5,0.5\right]^2$ using vortex blobs with $\sigma=0.01$, and $\mathrm{overlap}=1$, giving it a fixed blob spacing $h=0.01$. We employed the standard initialization method of vortex blobs from section \ref{subsec:vortexBlobInitialization}. However, as explained before, we have to take in account of the gaussian blurring of the original vorticity field and thus posses a problem when evaluating the error with the analytical Lamb-Oseen solution.

Barba \cite{Barba2004c}, had encountered the problem before when investigating with a Lamb-Oseen vortex. Her solution to the problem was to apply a ``time-shift correction", solving the problem of this very particular discretization of the diffusion equation using gaussian vortex blobs. Therefore, this is a special scenario and this approach cannot be used for other problems.

	\ctable[
		caption = {Summary of the Lamb-Oseen vortex evolution study parameters. Table shows the parameters of Tutty's diffusion method \cite{2010arXiv1009.0166T}},
		label   = {tab:lambOseenParams},
		pos = t,]{lcll}{}{\FL
		
		Parameters 					& Value 	& Unit					& Description \ML
		$\Gamma_c$\T               	& 1 &\si{m^2.s^{-1}} 				& Core strength\\
		$\Omega$               		& $\left[-0.5,0.5\right]^2$ &\si{m}	& Initial particle domain \\
		$\mathbf{u}_{\infty}$ 		& $\left[0, 0\right]$ &\si{m.s^{-1}} & Free-stream velocity\\
		$\nu$						& $\num{5e-4}$ &\si{kg.s^{-1}.m^{-1}}& Kinematic viscosity\\
		$ (\tau_0,\tau_f)$ 		    & \numrange{2e-3}{2.5e-3} &\si{m^2}	& Initial and final scaled viscous time\\
		$ (t_0,t_f)$ 		    	& \numrange{4}{5} &\si{s}			& Initial and final simulation time\\		
		$ \Delta t_c = \Delta t_d$ 	& $0.01$ &\si{s}						& Diffusion and convection time step size\\
		$ N_{\mathrm{t-steps}}$ 	& 100 & -						& Number of time integration steps\\		
		$ \sigma$ 					& $0.01$ &\si{m}						& Vortex blob core size\\	        
		$ \mathrm{overlap}$			& $1$	& -							& Overlap ratio\\	        	        
		$ k$						& $2$	& -							& Gaussian kernel width spreading\\
		$ f_{\mathrm{redist}}$		& $1$ 	& -							& Redistribution occurance\\	        	        
		$ f_{\mathrm{popControl}}$		& $1$  & -							& Population control occurance\\	        	        
		$ \Gamma_{\mathrm{threshold}}$ & $(\num{1e-14},\num{1e-14})$ &\si{m^2.s^{-1}} & Population control threshold\LL}

The ``time-shift correction" is derived by determining the diffusion effect caused by the discretization of the diffusion equation using gaussian blobs (with $k=2$). Barba determined that discretization of the diffusion equation reconstructs the vorticity field that has been diffused by $\sigma^2/2\nu$. So, in order to compare the results will have to shift the time by this value in order to compare with the analytical Lamb-Oseen solution. Therefore, when initializing the particles with a certain strength, we will have to reverse the time by $\sigma^2/2\nu$, giving us the initial particles strengths of the Lamb-Oseen vorticity field as,

	\begin{equation}
	\alpha_0 = \omega_0\cdot h^2 = \frac{\Gamma_c}{4\pi\nu\left(t-\sigma^2/2\nu\right)} \exp\left[-\frac{r^2}{4\nu\left(t-\sigma^2/2\nu\right)}\right].
	\end{equation}
	
Using this method, we can investigate the error growth of the vortex blob method. The vortex blobs where convected and diffused according to the parameters in table \ref{tab:lambOseenParams}. For the primary and the main investigation, we used diffusion method proposed by Tutty \cite{2010arXiv1009.0166T}. The advantage of this approach is that the we can perform diffusion after every convection step. This makes the method less prone to time integration error and eliminates any discontinuous behaviour in the evolution. We will see that when coupling the Lagrangian method and Eulerian method, discontinuity in the problem introduces additional errors.

	\begin{figure}[!t]
	\centering
	\includegraphics[width=0.99\textwidth]{figures/lagrangian/lambOseen_convection_vorticityErrorContours_compressed-crop.pdf}
	\caption{Relative error growth of Lamb-Oseen vorticity during the evolution (in logarithmic scale). The figure shows \textbf{(a)}, the initial relative error at $t_0=4$, and \textbf{(b)} the final relative error in vorticity at $t_f=5$.}
	\label{fig:lambOseen_convection_vorticityErrorContours_compressed}
	\end{figure}

So, using the Tutty's diffusion method (the simple restribution scheme), we convect at diffuse the vortex blobs at $\Delta t_c=\Delta t_d = 0.01$. The time integration of the problem is done using a $4^{\mathrm{th}}$-order Runge-Kutta method ($\mathrm{RK4}$). During the convection we will have to treat the lagrangian distortion using the remeshing scheme discussed before. The vortex blobs are remeshed every step ($f_{\mathrm{redist}}=1$). Remeshing at every step is not necessary and are typically every 10 iterations. However, as our diffusion scheme and hybrid method requires structured lattice of vortex blobs for efficient calculations, we remesh every step. The additional circulation processing we will have to do during the evolution of the vortex blobs is to remove unnecessary vortex blobs. To make the simulation as efficient as possible, it would be ideal to remove vortex elements where they are not needed. This is done by removing as many blobs as possible such that we does not violate the conservation of circulation to great extend. We places a cap of the maximum loss of total circulation, $\Gamma_{\mathrm{threshold}}=\num{1e-14}$. This process is referred to as ``population control" and is done at every iteration $f_{\mathrm{popControl}}=1$.

To verify where our Lagrangian scheme is function according to theory, we evaluated the error growth of the simulation with respect to the Lamb-Oseen analytical solution. Figure \ref{fig:lambOseen_convection_vorticityErrorContours_compressed}, shows the initial and the final relative error in vorticity. We see that initially we have a maximum relative error around \num{e-8} and the center of the Lamb-Oseen core. After 100 steps from $t_0=4$ to $t_f=5$, we see that the maximum relative error increased to \num{e-2}. The error of the vorticity are predominantly localized at the center of the core. This is because, this is where we have the highest gradient in the vorticity, as seen from figure \ref{fig:lambOseen_vorticityDistribution}. Therefore, with the current vortex blob discretization, we are not able to reconstruct this large gradient of the vorticity field. 

	\begin{figure}[!t]
	\centering
	\includegraphics[width=0.7\textwidth]{figures/lagrangian/lambOseen_convection_errorGrowth_compressed.pdf}
	\caption{Relative error growth of Lamb-Oseen vortex during the evolution from $t_0=4$ to $t_f=5$. Figure depicts the error in vorticity: maximum relative error [ ---, solid black], .error in $L^2-\mathrm{norm}$ [ - -, dashed black]; and error in velocity: maximum relative error [ {\color{plotBlue}{---}}, solid blue], error in $L^2-\mathrm{norm}$ [ {\color{plotBlue}{- -}}, dashed blue].}
	\label{fig:lambOseen_convection_errorGrowth_compressed}
	\end{figure}

Figure \ref{fig:lambOseen_convection_errorGrowth_compressed}, shows the error growth of the Lamb-Oseen vortex from $t_0=4$ to $t_f=5$. The figure plots the error growth of the vorticity and the velocity and due to the nature of the relationship with vorticity and velocity, the error in vorticity is an order higher that the error in velocity. The figure shows the both the maximum relative error, and the error in $L^2-\mathrm{norm}$. The maximum relative error (for example for vorticity), is determined as

	\begin{equation}
	\left\Vert \omega^{\mathrm{exact}} - \omega^{\mathrm{discrete}} \right\Vert_{\infty} = \frac{\max\{\left|\omega^{\mathrm{exact}} - \omega^{\mathrm{discrete}}\right|\}}{\max\{\left|\omega^{\mathrm{exact}}\right|\}}.
	\end{equation}

The error in $L^2-\mathrm{norm}$ of the vorticity is calculated as 

	\begin{equation}
	\left\Vert \omega^{\mathrm{exact}} - \omega^{\mathrm{discrete}} \right\Vert_2 = \left(\sum_{i}^{N}\left| \omega^{\mathrm{exact}} - \omega^{\mathrm{discrete}} \right|^2 \cdot h^2\right)^{\frac{1}{2}}.
	\end{equation}

The error in velocity is calculated in similar fashion. Investigating the plot, we see that after the first iteration, there is sudden increase in the error, however as time progresses, the error does not growth unbounded. From literature, we see that this trend has also been observed by Barba \cite{Barba2004c} and Speck \cite{Speck2011a}. For comparison, we used similar parameters and observe that the sudden jump in error has been similar to the literature.
	
\subsubsection*{Comparison of diffusion schemes: Tutty vs. Wee}

To validate that the Tutty diffusion scheme indeed performs better that the Wee's diffusion scheme, we compared the error growth of the problem using both diffusion schemes. Figure \ref{fig:lambOseen_diffusionMethod_comparison_compressed} shows the error growth of maximum relative error in vorticity of both diffusion schemes. The solid lines represents the solution of the Wee's diffusion scheme and the dashed lines shows the Tutty's diffusion scheme. The convection and the diffusion time steps where controlled by modifying the blob spacing $h$, and keeping the convection time step size $\Delta t_c = 0.01$. 

At $h = \num{4e-3}$, both schemes have the diffusion time step $\Delta t_d = 0.01$ meaning that the diffusion occurs at every iteration $k_d = 1$. During this time wee see that the Wee's diffusion scheme performs slightly better that Tutty's diffusion scheme. This is because, the diffusion of the vortex blobs is directly incorporated into the remeshing scheme, whereas the Tutty's simple redistribution scheme segregates the diffusion and the remeshing. At $h = \num{5e-3}$, the diffusion constraint of the Wee's diffusion scheme changes the allowable diffusion time step to $\Delta t_d = 0.02$, meaning that diffusion has to be performs at every second step $k_d=2$. When investigating the growth in error, we see that the diffusion scheme has a large increase in error, whereas the simple redistribution scheme does not have this limitation and is still able to diffuse at every step and has only a slight increase in error.

We see that the simple redistribution scheme is not only more stable at performing diffusion, but it is also more versatile as it only has an upper limit for $\Delta t_d$. Therefore, if were to use the Wee's modified interpolation kernel for diffusion, we must ensure that $k_d = 1$, by ensure $1/6 \le c^2 \le 1/2$. If this constraint is not possible we have to use Tutty's simple redistribution scheme.

	\begin{figure}[!b]
	\centering
	\includegraphics[width=0.7\textwidth]{figures/lagrangian/lambOseen_diffusionMethod_comparison_compressed.pdf}
	\caption{Comparison of Tutty's, simple redistribution scheme and Wee's modified interpolation method for treating diffusion. Figure depicts the growth in maximum relative error in vorticity from $t_0=4$ to $t_f=5$ at $\Delta t_c = 0.01$. The Wee diffusion scheme with $\Delta t_d = \Delta t_c = 0.01$ [{\color{plotBlue}{---}}, solid blue], and $\Delta t_d = 2 \Delta t_c = 0.02$ [---, solid black]. The Tutty's diffusion scheme, $c^2 = 1/3$, with $\Delta t_d = \Delta t_c = 0.01$ [ {\color{plotBlue}{- -}}, solid blue], and $\Delta t_d = \Delta t_c = 0.02$ [ - -, dashed black].}
	\label{fig:lambOseen_diffusionMethod_comparison_compressed}
	\end{figure}

\subsection{Convergence study of the viscous vortex method}

	\begin{figure}[!t]
	        \centering
	        \begin{subfigure}[b]{0.5\textwidth}
	                \includegraphics[width=\textwidth]{figures/lagrangian/lambOseen_convergence_dx_sigma0p02_compressed.pdf}
	                \caption{Error in vorticity vs. $h$ with $\sigma = 0.02$}
	                \label{fig:lambOseen_convergence_dx_sigma0p02_compressed}
	        \end{subfigure}%
	        ~ %add desired spacing between images, e. g. ~, \quad, \qquad etc.
	          %(or a blank line to force the subfigure onto a new line)
	        \begin{subfigure}[b]{0.5\textwidth}
	                \includegraphics[width=\textwidth]{figures/lagrangian/lambOseen_convergence_dx_compressed.pdf}
	                \caption{Error in vorticity vs. $h$, $\sigma$ with $\mathrm{overlap}=1$.}
	                \label{fig:lambOseen_convergence_dx_compressed}
	        \end{subfigure}
	        \caption{Convergence in spatial discretization of the vortex blobs. Figure \textbf{(a)} shows the convergence by fixing the core size $\sigma$ and \textbf{(b)} shows the convergence when overlap ratio is fixed.}
	        \label{fig:lambOseen_convergence_dx}
	\end{figure}

The final validation we can perform to ensure the scheme performs as according to theory is to perform a convergence study. For a numerical scheme that is stable, the error in discretization must converge as the resolution is increased. 

	\begin{figure}[!b]
	\centering
	\includegraphics[width=0.6\textwidth]{figures/lagrangian/lambOseen_convergence_dt_compressed.pdf}
	\caption{Error growth of Lamb-Oseen vorticity field after one-step.}
	\label{fig:lambOseen_convergence_dt_compressed}
	\end{figure}

In the case of spatial discretization, if we where to increase the spatial resolution the error must converge. As we are dealing with vortex blobs, there are multiple ways of increasing the resolution. The straight forward method would be to increase the density of particles in a given area, i.e. reducing the blob spacing $h$ and maintaining the core spreading $\sigma$. Figure \ref{fig:lambOseen_convergence_dx_sigma0p02_compressed} shows the convergence of the spatial discretization when the core size $\sigma$ is maintained at $\sigma=0.02$. At this case, the overlap ratio changes with the blob spacing according to equation \ref{eq:overlapRatio}. At lower blob spacing $h$, the error in vorticity quickly drops to near machine precision. This performs as expected and shows us that error converges as spatial resolution increased. Figure \ref{fig:lambOseen_convergence_dx_compressed}, shows the convergence of error when $\mathrm{overlap} = 1$, is maintained. This means that the blob spacing is equal to core size $h=\sigma$. So, when reducing the blobs spacing, this also reduces the core size. At this scenario, we see that there is also a convergence is spatial discretization.
	
To investigate the convergence in temporal discretization, we determined the growth in Lamb-Oseen vorticity field after convecting with various convection step size $\Delta t_c$. Note that we are using the Tutty's diffusion scheme, so $\Delta t_d = \Delta t_c$. We see that error converges at $\mathcal{O}(\Delta t)$, meaning that the aggregate convection and diffusion scheme is of first order. 


\section{Summary of the Lagrangian method}

In summary, the Lagrangian domain of the hybrid method has been described. The Lagrangian method is used to described the evolution of the wake past the geometry. As a wake predominantly involves in the convection and the diffusion of the wake, Vortex Particle Method is the ideal choice for this domain. Unlike, typical Eulerian method, VPM only required fluid elements where there is vorticity and this means the VPM is inherently auto-adaptive. Furthermore, the computation of the these elements have been accelerated using FMM and parallelized for GPU hardwares. This enables the method to be high efficient and allows for future scalability.

For the VPM, the choice of fluid elements was vortex blobs. This has non-zero core size, removing the singularity when performing Biot-Savart calculations. The strengths of these particles is initialized by assigning the local circulation strength to the particle, given by equation \ref{eq:particleCirculationAssignment}. We see that when dealing with only a Lagrangian method this does not pose a problem. However, when we perform coupling, we see that the gaussian blurring of the original vorticity field during the initialization is a fundamental source of error during the coupling. Strategies such as Beale's iterative method, can help us recover the original vorticity field, however, it is an ill-conditioned problem and can introduce errors. Moreover, we will see that this strategy is not viable when coupling as the correction can only be performed on a non-finite domain. The only approach to minimize this error is to reduce the gaussian spreading by increasing the overlap ratio to $overlap=1$ and minimize the blob spacing $h$ as much as possible. So, the proper handling of the initialization of the vortex blob strength is still an open question, and when solved can significantly improve the accuracy and the efficiency of the hybrid coupling. More on this will be discussed in section \ref{}. \todo{citation}

The convection of the vortex blobs is done using a $4^{\mathrm{th}}$-order Runge-Kutta Method. However, even with this higher order convection methods, we will have to deal with lagrangian grid distortion. Lagrangian distortion occurs when particles fail to maintain the overlap ratio as particles will tend to clump together and create regions of no fluid elements due to high strains in the fluid. To deal with this, we use a $\mathrm{M}'_4$ interpolation kernel that remeshing the particles that satisfies the conservation of circulation, linear and angular impulse. 

Diffusion of the vortex blobs is also an import part of the VPM. Initially, we employed the modified interpolation kernel by Wee \cite{}, which integrated the diffusion process into the standard interpolation kernel. However, the method poses two problems: the diffusion time step $\Delta t_d$ has a lower limit; the diffusion process introduces error when diffusion does not occur at every step, $k_d \neq 1$. To overcome this problem, we used the simple redistribution scheme by Tutty \cite{}, which enables us to perform diffusion at arbitrary time-steps, specifically at the same frequency as convection time step. So now, we can diffuse and convect at every iteration, which make the scheme more continuous and more ideal for coupling in the hybrid method.

To deal a body in the flow (for the Lagrangian method), we used vortex panels to enforce the no-slip boundary condition. Koumoutsakos, Leonard, Pepin \cite{}, have shown that enforcing no-slip boundary condition is equivalent to no-through boundary condition and they are linked to each. Constant-Strenth Vortex panels, based of Katz \cite{}, where used to treat the body and the problem was verified and validated with the analytical solution of a potential flow around a cylinder. There is one difference between our vortex panel method and the standard boundary element method used in VPM. The panels does not solve the problem of vorticity production from the body, as this is dealth with in the Eulerian domain and transfered to the Lagrangian domain. So when validation the Lagrangian method, we cannot validate a problem containing a body.

To validate the vortex blob only Lagrangian method, we used the analytical solution of the Lamb-Oseen vortex. We verified that the Wee's diffusion method indeed miss-performed when the diffusion was not done at every step. The validation was done by investigating the error in the vorticity and the velocity field and was able to conclude that the vortex blobs performed according to literature.

\subsection*{Lagrangian method algorithm}

	\begin{figure}[!t]
		\centering
		\begin{tikzpicture}
			[node distance=.8cm, start chain=going below,]
			\node[punktchain, join] (solvePanel) {Solve for panels};
		    \node[punktchain, join] (solveVelocity) {Determine the total velocity field};
		    \node[punktchain, join] (convect)     {Convect the vortex blobs};
		    \node[punktchain, join] (remesh) 	  {Remesh the Lagrangian field};
		    \node[punktchain, join] (diffuse)     {Diffuse the vortex blobs};		    
		\end{tikzpicture}
		\caption{Flowchart of the Lagrangian method. The flowchart shows coupling between vortex panels and vortex blobs to evolve from $t_n$ to $t_{n+1}$.}
		\label{fig:flowchart_lagrangian}
	\end{figure}
	

The flowchart to one time step of the Lagrangian method is given by figure \ref{fig:flowchart_lagrangian}.The algorithm to the Lagrangian method can be summarized as follows:

	\begin{enumerate}
	\item \textbf{Solve for panels:} Determine the strengths of the vortex panels $\gamma$, such that the no-slip boundary condition on the collocation points of the vortex panels is enforced. We will have ensure that the total circulation of the vortex panels satisfies the conservation of circulation.
	\item \textbf{Determine the total velocity field:} Determine the total velocity field $\mathbf{u}$, which is sum of the velocity field induced by the vortex blobs $\mathbf{u}_{\omega}$, the newly calculated vortex panels $\mathbf{u}_{\gamma}$ and free-stream flow $\mathbf{u}_{\infty}$. 
	\item \textbf{Convect the vortex blobs:} Use the velocity field to time march the vortex blobs to the new position, from $t_n$ to $t_{n+1}$, by the time step size $\Delta t_c$.
	\item \textbf{Remesh the Lagrangian field:} Remesh the vortex blobs onto a structured square lattices using the $\mathrm{M}'_4$ interpolation kernel.
	\item \textbf{Diffuse the vortex blobs:} Diffuse the vortex blobs using the $\Delta t_d$ diffusion time step, by modifying the strengths of the vortex blobs according to simple redistribution method for treating diffusion.
	\end{enumerate}

The difference here is that the vorticity is not generated from the body in this algorithm. We introduce the vorticity generation from the Eulerian method by interpolating the new vorticity field from the Eulerian domain onto the Lagrangian domain using the Hybrid coupling strategys.

